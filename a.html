<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro Paint - Minimal</title>
    <style>
        :root {
            --ui-bg: #c0c0c0;
            --shadow: #808080;
            --light: #ffffff;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background: var(--shadow);
            font-family: sans-serif;
            display: flex; flex-direction: column;
        }

        /* Toolbar pinned to top */
        .toolbar {
            background: var(--ui-bg);
            border-bottom: 2px solid var(--shadow);
            display: flex;
            padding: 4px;
            gap: 4px;
            z-index: 100;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--ui-bg);
            border: 2px solid;
            border-color: var(--light) var(--shadow) var(--shadow) var(--light);
            padding: 6px 12px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn:active, .btn.active {
            border-color: var(--shadow) var(--light) var(--light) var(--shadow);
            background: #d0d0d0;
        }

        /* Canvas Container */
        #container {
            flex-grow: 1;
            position: relative;
            background: #555;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            background: white;
            image-rendering: pixelated;
            cursor: crosshair;
        }

        /* Palette pinned to bottom */
        .palette {
            background: var(--ui-bg);
            border-top: 2px solid var(--shadow);
            display: flex;
            padding: 6px;
            gap: 8px;
            align-items: center;
        }

        .colors-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
        }

        .swatch {
            width: 18px; height: 18px;
            border: 1px inset white;
            cursor: pointer;
        }

        #activeColor {
            width: 30px; height: 30px;
            border: 2px inset white;
            background: black;
        }
    </style>
</head>
<body>

<div class="toolbar">
    <button class="btn active" onclick="setMode('brush')">Pencil</button>
    <button class="btn" onclick="setMode('rect')">Rect</button>
    <button class="btn" onclick="setMode('circle')">Circle</button>
    <button class="btn" onclick="fillCanvas()">Fill</button>
    <button class="btn" onclick="clearCanvas()">Clear</button>
    <button class="btn" onclick="save()">Save</button>
    <span style="font-size: 10px; margin-left: auto; align-self: center; padding-right: 10px;">Paste (Ctrl+V) enabled</span>
</div>

<div id="container">
    <canvas id="paintCanvas"></canvas>
</div>

<div class="palette">
    <div id="activeColor"></div>
    <div class="colors-grid" id="swatches"></div>
    <input type="range" id="size" min="1" max="25" value="4">
</div>

<script>
    const canvas = document.getElementById('paintCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('container');
    const swatches = document.getElementById('swatches');
    const activeCol = document.getElementById('activeColor');

    let drawing = false;
    let mode = 'brush';
    let color = '#000000';
    let startX, startY;
    let snapshot;

    const colors = [
        '#000000', '#ffffff', '#808080', '#c0c0c0', '#ff0000', '#800000', 
        '#ffff00', '#808000', '#00ff00', '#008000', '#00ffff', '#008080', 
        '#0000ff', '#000080', '#ff00ff', '#800080', '#ffa500', '#a52a2a', '#ffc0cb', '#4b0082'
    ];

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = container.clientHeight;
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
    }

    colors.forEach(c => {
        const div = document.createElement('div');
        div.className = 'swatch';
        div.style.background = c;
        div.onclick = () => { color = c; activeCol.style.background = c; };
        swatches.appendChild(div);
    });

    function setMode(m) {
        mode = m;
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }

    function getXY(e) {
        const r = canvas.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        return [cx - r.left, cy - r.top];
    }

    canvas.onmousedown = canvas.ontouchstart = (e) => {
        drawing = true;
        [startX, startY] = getXY(e);
        snapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
    };

    window.onmousemove = window.ontouchmove = (e) => {
        if (!drawing) return;
        const [currX, currY] = getXY(e);
        ctx.putImageData(snapshot, 0, 0);
        ctx.strokeStyle = color;
        ctx.lineWidth = document.getElementById('size').value;

        if (mode === 'brush') {
            ctx.lineTo(currX, currY);
            ctx.stroke();
            snapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
        } else if (mode === 'rect') {
            ctx.strokeRect(startX, startY, currX - startX, currY - startY);
        } else if (mode === 'circle') {
            const rad = Math.sqrt((currX - startX)**2 + (currY - startY)**2);
            ctx.beginPath();
            ctx.arc(startX, startY, rad, 0, Math.PI * 2);
            ctx.stroke();
        }
    };

    window.onmouseup = window.ontouchend = () => {
        drawing = false;
        ctx.beginPath();
    };

    // INVISIBLE PASTE FUNCTIONALITY
    window.addEventListener('paste', (e) => {
        const items = e.clipboardData.items;
        for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                const blob = items[i].getAsFile();
                const img = new Image();
                img.onload = () => {
                    ctx.imageSmoothingEnabled = false; // Keep it retro/crunchy
                    ctx.drawImage(img, 20, 20); 
                };
                img.src = URL.createObjectURL(blob);
            }
        }
    });

    function fillCanvas() {
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function clearCanvas() {
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function save() {
        const link = document.createElement('a');
        link.download = 'pixel-art.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    window.onresize = init;
    init();
</script>

</body>
</html>