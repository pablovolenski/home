<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Board</title>
    <style>
        :root {
            --bg-color: #e5e5f7;
            --dot-color: #cbcbcb;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; /* Prevents browser scroll */
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--dot-color) 1px, transparent 0);
            background-size: 30px 30px; /* Blueprint/Grid look */
            font-family: 'sans-serif';
        }

        #canvas {
            width: 5000px; height: 5000px; /* Large workspace */
            position: relative;
        }

        .note {
            position: absolute;
            background: #fff9c4;
            width: 200px; height: 150px;
            padding: 10px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.15);
            display: flex; flex-direction: column;
            cursor: grab;
            resize: both; /* Native browser resizing */
            overflow: auto;
            min-width: 100px; min-height: 80px;
        }

        .note:active { cursor: grabbing; }

        .note textarea {
            flex-grow: 1; border: none; background: transparent;
            resize: none; outline: none; font-size: 14px;
        }

        .controls {
            position: fixed; bottom: 20px; left: 20px;
            display: flex; gap: 10px; z-index: 100;
        }

        button {
            padding: 10px 20px; border-radius: 8px; border: none;
            background: #333; color: white; cursor: pointer;
            font-weight: bold;
        }

        .delete-btn {
            position: absolute; top: 2px; right: 5px;
            font-size: 12px; color: #999; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="controls">
        <button onclick="addNote()">+ New Note</button>
        <small>Drag notes by the edges. Resize from bottom-right.</small>
    </div>

    <div id="canvas"></div>

    <script>
        const canvas = document.getElementById('canvas');
        let notes = JSON.parse(localStorage.getItem('sticky_v2') || '[]');

        function init() {
            notes.forEach(renderNote);
            // Center the view initially
            window.scrollTo(2200, 2200);
        }

        function renderNote(note) {
            const div = document.createElement('div');
            div.className = 'note';
            div.style.left = note.x + 'px';
            div.style.top = note.y + 'px';
            div.style.width = (note.w || 200) + 'px';
            div.style.height = (note.h || 150) + 'px';

            div.innerHTML = `
                <span class="delete-btn" onclick="deleteNote(${note.id}, this.parentElement)">âœ•</span>
                <textarea oninput="updateContent(${note.id}, this.value)">${note.content}</textarea>
            `;

            // Dragging Logic
            div.onmousedown = function(e) {
                if (e.target.tagName === 'TEXTAREA' || e.target.className === 'delete-btn') return;
                
                let shiftX = e.clientX - div.getBoundingClientRect().left;
                let shiftY = e.clientY - div.getBoundingClientRect().top;

                function moveAt(pageX, pageY) {
                    let newX = pageX - shiftX + window.scrollX;
                    let newY = pageY - shiftY + window.scrollY;
                    div.style.left = newX + 'px';
                    div.style.top = newY + 'px';
                    updatePos(note.id, newX, newY);
                }

                function onMouseMove(e) { moveAt(e.clientX, e.clientY); }
                document.addEventListener('mousemove', onMouseMove);
                
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.onmouseup = null;
                };
            };

            // Resize Observer to save dimensions
            const ro = new ResizeObserver(entries => {
                for (let entry of entries) {
                    updateSize(note.id, entry.contentRect.width, entry.contentRect.height);
                }
            });
            ro.observe(div);

            canvas.appendChild(div);
        }

        function addNote() {
            const newNote = {
                id: Date.now(),
                content: "",
                x: window.scrollX + 100,
                y: window.scrollY + 100,
                w: 200, h: 150
            };
            notes.push(newNote);
            save();
            renderNote(newNote);
        }

        function updateContent(id, text) {
            notes.find(n => n.id === id).content = text;
            save();
        }

        function updatePos(id, x, y) {
            const n = notes.find(n => n.id === id);
            n.x = x; n.y = y;
            save();
        }

        function updateSize(id, w, h) {
            const n = notes.find(n => n.id === id);
            if(n) { n.w = w; n.h = h; save(); }
        }

        function deleteNote(id, el) {
            notes = notes.filter(n => n.id !== id);
            save();
            el.remove();
        }

        function save() { localStorage.setItem('sticky_v2', JSON.stringify(notes)); }

        init();
    </script>
</body>
</html>